"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[7271],{42923:(e,t,s)=>{s.d(t,{qualifyProName:()=>i,QualifiedSources:()=>n});var n,o=s(88537),r=s(82527);s(21167);function i(e){return e}!function(e){function t(e){return e.pro_name}function s(e){{const t=r.enabled("pay_attention_to_ticker_not_symbol")?e.ticker:e.full_name;return(0,o.ensureDefined)(t)}}e.fromQuotesSnapshot=function(e){return"error"===e.status?e.symbolname:e.values.pro_name},e.fromQuotesResponse=function(e){const{values:s,symbolname:n,status:o}=e;return"error"===o&&n?n:t(s)},e.fromQuotes=t,e.fromSymbolSearchResult=function(e,t){{const{ticker:s,full_name:n}=null!=t?t:e;return r.enabled("pay_attention_to_ticker_not_symbol")?(0,o.ensureDefined)(null!=s?s:n):(0,o.ensureDefined)(n)}},e.fromSymbolInfo=s,e.fromSymbolMessage=function(e,t){return"symbol_resolved"===t.method?s(t.params[1]):e}}(n||(n={}))},84327:(e,t,s)=>{function n(e){return""===e.value()}function o(e,t){return e.filter(e=>e.includes(t))}function r(e){const t=new Map;return e.forEach(e=>{t.has(e.group())?t.get(e.group()).push(e):t.set(e.group(),[e])}),t}function i(e,t){return t.map(t=>new e(t))}s.d(t,{isAllSearchSourcesSelected:()=>n,filterSearchSources:()=>o,splitSearchSourcesByGroup:()=>r,createSearchSources:()=>i})},21167:(e,t,s)=>{s.d(t,{exchangeSelectDisabled:()=>m,getAllSymbolTypesValue:()=>h,getAvailableExchanges:()=>l,getAvailableSearchSources:()=>a,getAvailableSymbolTypes:()=>u,getDefaultSearchSource:()=>c,getSymbolFullName:()=>i,isOpenFirstContractEnabled:()=>y});var n=s(25177),o=s(84327);class r{constructor(e){this._exchange=e}value(){return this._exchange.value}name(){return(0,o.isAllSearchSourcesSelected)(this)?(0,n.t)("All sources"):this._exchange.name}description(){return this._exchange.desc}country(){return this._exchange.country}providerId(){return this._exchange.providerId}group(){return this._exchange.group}includes(e){return function(e,t){const s=t.toLowerCase(),{name:n,desc:o,searchTerms:r}=e;return n.toLowerCase().includes(s)||o.toLowerCase().includes(s)||void 0!==r&&r.some(e=>e.toLowerCase().includes(s))}(this._exchange,e)}getRequestExchangeValue(){return this._exchange.value}getRequestCountryValue(){}}function i(e){if(e.fullName)return e.fullName;let t;return t=e.prefix||e.exchange?(e.prefix||e.exchange)+":"+e.name:e.name,t.replace(/<\/?[^>]+(>|$)/g,"")}function c(){const e=a();return e.find(o.isAllSearchSourcesSelected)||e[0]||null}function a(){return(0,o.createSearchSources)(r,d())}function l(){return d()}function d(){return window.ChartApiInstance.supportedExchangesList().map(e=>({...e,country:"",providerId:"",flag:""}))}function u(){return window.ChartApiInstance.supportedSymbolsTypes()}function h(){return""}function m(){return!1}const y=!1},26163:(e,t,s)=>{s.r(t),s.d(t,{CompareModel:()=>v});var n=s(88537),o=s(82527),r=s(20060),i=s(71405),c=s(94489),a=s.n(c),l=s(6519),d=s(63002),u=s(30647),h=s(42923),m=s(21167)
;new Set(o.enabled("widget")?["pro_name","short_name","description","exchange","type","country_code","provider_id"]:["pro_name","short_name","description","exchange","type","country_code","provider_id","logoid","currency-logoid","base-currency-logoid"]);const y=(0,m.getAvailableExchanges)(),S={};for(const e of y)S[e.value]={country:e.country,providerId:e.providerId};function _(e){return e instanceof d.study_Overlay||e instanceof u.StudyCompare}function p(e,t,s){const n=h.QualifiedSources.fromSymbolInfo(e),o=function(e){if(!e)return;const[t,s]=e.split(":");return s&&t&&S[t]?S[t]:void 0}(n);return{id:(null==s?void 0:s.id())||n,symbol:n,checked:t,title:e.name,description:e.description,exchangeName:e.exchange,country:null==o?void 0:o.country,providerId:null==o?void 0:o.providerId,marketType:e.type,study:s}}function f(e,t,s,n){return{id:void 0!==s?s.id():e,symbol:e,checked:t,title:e,study:s,description:n}}var b=s(70122),g=s(98171);class v{constructor(e){this._contentItemList=new(a())([]),this._checkedSymbols=new Map,this._recentLength=10,this._isDataReady=new(a())(!1),this._highlightedSymbol=new(a())(null),this._defaultSymbolsDescriptions=new Map,this._idToStudyMap=new Map,this._chartSession=null,this._recentSymbolsEnabled=o.enabled("compare_recent_symbols_enabled"),this._preventHandleSourcesChange=!0,this.removeStudy=e=>{const{symbol:t,study:s}=e;if(!s)return;this._chartWidget.model().removeSource(s,!1);const n=this._checkedSymbols.get(t);n&&n.length>1?this._removeStudyIdFromCheckedSymbols(t,s.id()):this._checkedSymbols.delete(t),this._updateContentItemList(this._contentItemList.value(),!0)},this._getResolveSymbolPromise=(e,t)=>new Promise(s=>{const o=(0,n.ensureNotNull)(this._chartSession).resolveSymbol((0,r.makeNextSymbolId)(),(0,i.encodeExtendedSymbolOrGetSimpleSymbolString)({symbol:e}),s);t&&t.set(e,o)}),this._chartWidget=e.activeChartWidget.value(),this._chartSession=this._chartWidget.model().model().chartApi();const t=new Set(this._loadRecent().reverse()),s=new Set,c=new Set,l=this._chartWidget.model().model().dataSources().filter(_),d=l.map(e=>{const t=e.symbolInfo();if(t)return Promise.resolve(h.QualifiedSources.fromSymbolInfo(t));const s=e.symbol();return(0,h.qualifyProName)(s)});Promise.all(d).then(e=>{const n=e.map((e,t)=>l[t]);e.forEach((e,o)=>{const r=n[o],i=r.id();this._addStudyIdToCheckedSymbols(e,i),this._idToStudyMap.set(i,r),t.has(e)?s.add(e):c.add(e)});const o=Array.from(t).filter(e=>this._checkedSymbols.has(e)).reduce((e,t)=>(s.has(t)&&e.push(t),e),[]).concat(Array.from(c)),r=Array.from(t);if(this._recentSymbolsEnabled&&r.length<this._recentLength){let e;e=[],this._chartWidget.compareSymbols()&&this._chartWidget.compareSymbols().forEach(t=>{e.push((0,h.qualifyProName)(t.symbol)),this._defaultSymbolsDescriptions.set(t.symbol,t.title)});const t=[...r,...e];o.push(...t)}else o.push(...r);const i=Array.from(new Set(o));{const e=new Map,t=i.map(t=>this._getResolveSymbolPromise(t,e));Promise.all(t).then(t=>this._handleInitProcess(o,s=>{const n=e.get(s);return t.find(e=>e.params[0]===n)
},(e,t)=>h.QualifiedSources.fromSymbolMessage(t,e),(e,t,s,n)=>"symbol_resolved"===e.method?p(e.params[1],s,n):f(t,s,n,this._getSymbolDescription(t))))}})}chartModel(){return this._chartWidget.model().model()}handleSourcesChange(){if(this._preventHandleSourcesChange)return;const e=this.chartModel().dataSources().filter(_),t=new Set(e.map(e=>e.id()));Array.from(t).forEach(e=>{if(!this._checkedStudiesIds().has(e)){const t=this.chartModel().dataSourceForId(e)||null;if(null!==t&&_(t)){const t=this._getContentItemByStudyId(e);if(!t)return;this._addStudyIdToCheckedSymbols(t.symbol,e),this._saveRecent(t.symbol),this._updateContentItemList(this._contentItemList.value(),!0)}}});Array.from(this._checkedStudiesIds()).forEach(e=>{if(!t.has(e)){const t=this._getContentItemByStudyId(e);if(!t)return;const s=this._checkedSymbols.get(t.symbol);s&&s.length>1?this._removeStudyIdFromCheckedSymbols(t.symbol,e):this._checkedSymbols.delete(t.symbol),this._updateContentItemList(this._contentItemList.value(),!0)}})}studies(){return this._contentItemList.readonly()}isDataReady(){return this._isDataReady.readonly()}highlightedSymbol(){return this._highlightedSymbol.readonly()}applyStudy(e,t,s){const n=this._chartWidget;if(!n)return;if((0,g.isSeparatorItem)(e))return;let o;switch(t){case l.CompareOption.SameScale:o=n.addCompareAsOverlay(e,s);break;case l.CompareOption.NewPriceScale:o=n.addOverlayStudy(e,!0,s);break;case l.CompareOption.NewPane:o=n.addOverlayStudy(e,!1,s)}Promise.all([this._getResolveSymbolPromise(e),o]).then(t=>this._handleApplyProcess(t,t=>h.QualifiedSources.fromSymbolMessage(e,t),(e,t,s)=>"symbol_resolved"===e.method?p(e.params[1],!0,s):f(t,!0,s)))}_snapshoter(){throw new Error("not implemented")}_handleApplyProcess(e,t,s){const[n,o]=e;if(!n||null===o)return;const r=o.id(),i=t(n),c=s(n,i,o);this._saveRecent(i),this._addStudyIdToCheckedSymbols(i,r),this._showNewItem(c,i,r)}_handleInitProcess(e,t,s,n){const o=[];for(const r of e){const e=t(r);if(!e)continue;const i=s(e,r),c=this._checkedSymbols.get(i),a=-1!==o.findIndex(e=>e.symbol===i);if(void 0===c||a)this._recentSymbolsEnabled&&o.push(n(e,i,!1));else for(const t of c)o.push(n(e,i,!0,this._idToStudyMap.get(t)))}this._updateContentItemList(o),this._isDataReady.setValue(!0)}_showNewItem(e,t,s){const n=this._contentItemList.value().map(this._updateChecked,this);n.unshift(e),this._recentSymbolsEnabled&&n.unshift({...e,id:t,study:void 0,checked:!1}),this._updateContentItemList(n),this._highlightedSymbol.setValue(s),setTimeout(()=>this._highlightedSymbol.setValue(null),500)}_addStudyIdToCheckedSymbols(e,t){const s=this._checkedSymbols.get(e)||[];this._checkedSymbols.set(e,[...s,t])}_removeStudyIdFromCheckedSymbols(e,t){const s=this._checkedSymbols.get(e);if(s){const n=s.indexOf(t);s.splice(n,1),this._checkedSymbols.set(e,s)}}_updateChecked(e){var t;const s=this._checkedSymbols.get(e.symbol),n=null===(t=e.study)||void 0===t?void 0:t.id();return n?{...e,checked:Boolean(s&&s.includes(n))}:e}_updateContentItemList(e,t){const s=t?e.map(this._updateChecked,this):e,n=s.filter(e=>e.checked)
;if(this._recentSymbolsEnabled){const e=new Set,t=s.reduce((t,s)=>(s.checked||e.has(s.symbol)||(t.push(s),e.add(s.symbol)),t),[]).slice(0,this._recentLength);this._contentItemList.setValue(n.concat(t))}else this._contentItemList.setValue(n)}_checkedStudiesIds(){const e=[].concat(...Array.from(this._checkedSymbols.values()));return new Set(e)}_getContentItemByStudyId(e){const t=this._contentItemList.value(),s=t.findIndex(t=>t.study&&t.study.id()===e);return t[s]}_loadRecent(){return this._recentSymbolsEnabled?b.getJSON("CompareDialog.recent",[]):[]}_saveRecent(e){if(!this._recentSymbolsEnabled)return;const t=new Set(this._loadRecent());t.has(e)&&t.delete(e),t.add(e),b.setJSON("CompareDialog.recent",Array.from(t).slice(-this._recentLength))}_getSymbolDescription(e){var t;return this._defaultSymbolsDescriptions.size&&null!==(t=this._defaultSymbolsDescriptions.get(e))&&void 0!==t?t:""}}v._snapshoter=null},6519:(e,t,s)=>{var n;s.d(t,{CompareOption:()=>n}),function(e){e[e.SameScale=0]="SameScale",e[e.NewPriceScale=1]="NewPriceScale",e[e.NewPane=2]="NewPane"}(n||(n={}))},98171:(e,t,s)=>{function n(e){return!1}s.d(t,{isSeparatorItem:()=>n})}}]);